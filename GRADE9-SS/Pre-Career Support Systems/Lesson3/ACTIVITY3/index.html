<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Build Your Personal Support Strategy</title>
<style>
    /* ====== FONT IMPORTS ====== */
    @font-face {
      font-family: 'Fredoka';
      src: url('../assets/Fredoka-VariableFont_wdth\,wght.ttf') format('truetype');
    }
    ::-webkit-scrollbar{
        display: none;
    }
    
    /* ====== KEYFRAMES ====== */
    @keyframes glow-pulse-white {
      0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.7), 0 0 20px rgba(255,255,255,0.5); transform: scale(1); }
      50% { box-shadow: 0 0 20px rgba(255,255,255,1), 0 0 30px rgba(255,255,255,0.7); transform: scale(1.1); }
    }
    @keyframes glow-pulse {
        0%, 100% {
            box-shadow: 0 0 10px rgba(251, 176, 59, 0.5), 0 0 20px rgba(251, 176, 59, 0.3);
            transform: scale(1);
        }
        50% {
            box-shadow: 0 0 20px rgba(251, 176, 59, 0.8), 0 0 30px rgba(251, 176, 59, 0.5);
            transform: scale(1.1);
        }
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); } }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
    
    /* ====== ROOT VARIABLES & SCALING ====== */
    :root {
      --primary-color: #5D04B2;
      --secondary-color: #FBB03B;
      --correct-color: #5cb85c;
      --incorrect-color: #d9534f;
      --text-color-dark: #333;
      --text-color-light: #fff;
      --border-radius: 1rem;
      --header-font: 'Fredoka', 'Poppins', sans-serif;
      --body-font: var(--header-font);
    }
    html {
      font-size: 1.8vmin;
    }
    
    /* Optional global base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
        width: 100%;
        height: 100vh;
        overflow: hidden; 
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #e6eef7;
        font-family: var(--body-font);
    }

    #game-wrapper {
        width: 100%;
        max-width: 1200px;
        height: auto;
        aspect-ratio: 16 / 9;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        background: #fff;
    }
    
    #game-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .screen {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        overflow: hidden;
    }

    .screen.hidden {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.95);
    }
    
    /* ===== START SCREEN ===== */
    #start-screen {
      color: var(--text-color-light);
      text-align: center;
      padding: 2rem;
      background-image: url('images/gamebg.jpg');
      background-size: cover;
      background-position: center;
      justify-content: center;
      align-items: center;
    }
    #start-screen h1 {
      color: var(--text-color-light);
      font-size: 3rem;
      font-family: var(--header-font);
      font-weight: 500;
    }
    .start-button {
      font-family: var(--header-font);
        background: var(--secondary-color);
        color: var(--text-color-light);
        font-weight: 500;
        font-size: 1.2rem;
        border: 3px solid #fff;
        border-radius: 4.8rem;
        padding: 1rem 2rem;
        margin-top: 1.6rem;
        cursor: pointer;
        text-shadow: 0 0.2rem 0 #b88b2a;
        transition: all 0.2s;
    }
    .start-button:hover {
      transform: scale(1.06);
      box-shadow: 0 6px 24px rgba(0,0,0,0.18);
    }

    /* ===== GAME SCREEN BASE ===== */
    #game-screen {
      justify-content: flex-start;
      overflow: hidden;
      position: relative;
      background: #f0f4f8; 
      padding-top: 60px; /* Space for the top bar */
    }
    .game-top-section {
        width: 100%;
        background-color: var(--primary-color);
        padding: clamp(0.05rem, 1vmin, 0.1rem) clamp(0.25rem, 1.5vmin, 0.65rem);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #fff;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    #game-title {
      font-size: clamp(1.5rem, 3.5vmin, 2.2rem);
      font-weight: 600;
      margin: 0;
      font-family: var(--header-font);
    }
    .top-right-controls {
        display: flex;
        align-items: center;
        gap: clamp(0.5rem, 2vw, 1.5rem);
        padding: clamp(0.25rem, 1vw, 0.75rem);
        font-size: clamp(0.8rem, 2vw, 1.2rem);
    }
    .control-icon {
      width: 2.5rem; 
      height: 2.5rem;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex; 
      align-items: center; 
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 15; 
      flex-shrink: 0;
    }
    .control-icon:hover {
      background: rgba(255, 255, 255, 0.3); 
      transform: scale(1.1);
    }
    .control-icon svg {
      width: 1.25rem; 
      height: 1.25rem; 
      fill: white;
    }
    #instructions-icon {
        animation: glow-pulse-white 2s infinite;
    }
    
    #progress-container {
      width: clamp(100px, 20vw, 200px);
      background-color: rgba(255,255,255,0.3);
      border-radius: 1rem;
      height: clamp(15px, 2.5vmin, 20px);
      border: 2px solid #fff;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background: #FFFF00;
      border-radius: 0.8rem;
      transition: width 0.5s ease;
    }
    #progress-text {
      font-weight: 700; 
      color: #fff;
      font-size: clamp(1rem, 2vmin, 1.4rem);
    }

    /* ====== STRATEGY CHECKLIST STYLING ====== */
    #strategy-container {
        width: 100%;
        height: 100%;
        padding: clamp(1rem, 2.5vmin, 2rem);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(372px, 1fr));
        gap: clamp(0.75rem, 2vmin, 1.5rem);
        overflow-y: auto;
        align-content: start;
    }

    .strategy-card {
        background: linear-gradient(145deg, #ffffff, #e6eff8);
        border-radius: var(--border-radius);
        padding: clamp(1rem, 2vmin, 1.5rem);
        text-align: center;
        font-size: clamp(0.9rem, 2.2vmin, 1.1rem);
        font-weight: 500;
        color: var(--text-color-dark);
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 2px solid #dde8f3;
        transition: all 0.2s ease-out;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100px;
    }

    .strategy-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 8px 25px rgba(93, 4, 178, 0.12);
        border-color: var(--primary-color);
    }
    
    .strategy-card.selected {
        border-color: var(--correct-color);
        background: hsl(120, 73%, 96%);
        color: #333;
        animation: glow-pulse-correct 1.5s;
        pointer-events: none;
    }
    
    .strategy-card.incorrect {
        border-color: var(--incorrect-color);
        background: hsl(2, 73%, 96%);
        color: #333;
        pointer-events: none;
    }

    @keyframes glow-pulse-correct {
        0%, 100% { box-shadow: 0 0 10px rgba(92, 184, 92, 0.4); }
        50% { box-shadow: 0 0 20px rgba(92, 184, 92, 0.8); }
    }

    .strategy-card.shake {
        animation: shake 0.5s;
    }

    .strategy-card .checkmark, .strategy-card .crossmark {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        color: white;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 16px;
    }
    .strategy-card .checkmark { background-color: var(--correct-color); }
    .strategy-card .crossmark { background-color: var(--incorrect-color); }

    .strategy-card.selected .checkmark { display: flex; }
    .strategy-card.incorrect .crossmark { display: flex; }


    /* ===== MODALS & OVERLAYS ===== */
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.4);
      backdrop-filter: blur(5px);
      z-index: 3000;
      display: flex; justify-content: center; align-items: center;
      animation: fadeIn 0.3s ease;
    }
    .overlay.hidden {
      display: none; visibility: hidden; opacity: 0;
    }
    .modal {
      background: #fff;
      padding: 2.5rem;
      border-radius: 1rem;
      text-align: center;
      width: 90%; max-width: 500px;
      animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .modal h2 {
      font-size: 1.8rem; font-weight: 600; margin-bottom: 1.5rem; font-family: var(--header-font);
    }
    .modal p, .modal li, .modal ul {
      font-size: 1.2rem; line-height: 1.6; color: var(--text-color-dark); text-align: left;
    }
    .modal ul { list-style: none; padding: 0;}
    
    #activity-intro-overlay .modal { border-top: 8px solid var(--primary-color); }
    #activity-intro-overlay .modal h2 { color: var(--primary-color); }
    #activity-intro-overlay .modal p { background: #f8f9fa; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid var(--primary-color); text-align: center; font-size: 1.3rem;}
    
    #instructions-overlay .modal { border-top: 8px solid var(--primary-color); }
    #instructions-overlay .modal h2 { color: var(--primary-color); }
    #instructions-overlay .modal p { text-align: center; }
    #instructions-overlay .modal ul { padding-left: 1rem; list-style-type: disc;
        list-style-position: outside;
        padding-inline-start: 1.5rem; }
    #instructions-overlay .modal ul li { margin-bottom: 0.5rem; }
    
    .feedback-modal { max-width: 480px; }
    .feedback-header {
      display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem;
    }
    .feedback-header svg {
        width: 2rem;
        height: 2rem;
        flex-shrink: 0;
    }
    .feedback-header h2 { font-size: 2rem; font-weight: 700; margin: 0; }
    .feedback-header.correct h2 { color: var(--correct-color); }
    .feedback-header.incorrect h2 { color: var(--incorrect-color); }
    .feedback-btn.correct { background-color: var(--correct-color); }
    .feedback-btn.incorrect { background-color: var(--incorrect-color); }
    #feedback-modal-overlay.correct-feedback .modal { border-top: 8px solid var(--correct-color); }
    #feedback-modal-overlay.incorrect-feedback .modal { border-top: 8px solid var(--incorrect-color); }
    #feedback-modal-text{
        text-align: center;
    }

    .modal button {
      width: 100%; padding: 1rem; font-size: 1.2rem; font-weight: 700;
      border: none; border-radius: 0.75rem; cursor: pointer; color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 1rem;
    }
    .modal button:hover { transform: scale(1.02); }
    #activity-intro-overlay button, #instructions-overlay button { background-color: var(--primary-color); }
    
    /* ===== COMPLETION OVERLAY ===== */
    #completion-overlay {
      background-image: url('images/gamebg.jpg'); background-size: cover; background-position: center;
      color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center;
      gap: 1rem; padding: 1rem;
    }
    .completion-title-banner {
      font-size: clamp(2.6rem, 7vmin, 4rem);
      text-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.2);
      text-align: center;
      font-family: var(--header-font);
      font-weight: 500;
    }
    #completion-overlay .modal {
      background: transparent; box-shadow: none; width: auto; max-width: none;
      display: flex; justify-content: center; align-items: center;
      padding: 0; overflow: visible;
    }
    #completion-image {
      width: clamp(400px, 70%, 700px); max-width: 85%; height: auto;
      border: 3px solid var(--secondary-color);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      margin-top: 0.5rem;
    }
    .completion-buttons {
        position: static; width: 100%; display: flex; justify-content: space-between;
        gap: 1rem; padding: 0 2rem 2rem 2rem; box-sizing: border-box;
        align-items: flex-end; margin-top: 0;
    }
    .completion-btn {
        font-family: var(--header-font); background: var(--secondary-color); color: #fff;
        font-weight: 500; 
        font-size: 1.3rem;
        border: 0.1875rem solid #fff; border-radius: 3rem; 
        padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(1.25rem, 3vmin, 2rem);
        cursor: pointer; transition: all 0.2s;
        box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
        text-shadow: 0 0.125rem 0 #b88b2a; text-decoration: none;
        min-width: 8.75rem; /* 140px */
    }
    .completion-btn:hover { transform: scale(1.05); box-shadow: 0 0.5rem 1.25rem rgba(0,0,0,0.2); }
    
    /* ===== TAKEAWAYS OVERLAY ===== */
    #takeaways-overlay {
        background-image: url(images/gamebg.jpg); flex-direction: column; justify-content: center;
    }
    .takeaways-main-header {
        font-family: var(--header-font); color: white; font-size: 2.5rem;
        position: absolute; top: 5%; text-align: center; width: 100%;
        text-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.3);
    }
    #takeaways-overlay .modal { max-width: 800px; padding: 2rem; display: flex; flex-direction: column; align-items: center; height: 50vh;
        overflow-y: auto; margin-top: 3rem; border-top: 5px solid var(--secondary-color);
    }
    .takeaways-header { color:var(--primary-color); display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; }
    .takeaways-header h3 { font-family: var(--header-font); font-size: 1.8rem; color: var(--primary-color); }
    #takeaways-list { list-style-type: none; padding: 0; width: 100%; }
    #takeaways-list li {
        background: none;
        border-left: none;
        margin-bottom: 0rem;
        padding: 1rem 1rem 1rem 2.5rem;
        border-radius: 0.5rem;
        font-size: 1.1rem;
        text-align: left;
        position: relative;
    }
    #takeaways-list li::before {
        content: '';
        display: inline-block;
        position: absolute;
        left: 0.8rem;
        top: 50%;
        transform: translateY(-50%);
        width: 1.2rem;
        height: 1.2rem;
        background: none;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%235cb85c" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 10.8 17 4 10.8"/></svg>');
        background-size: 1.2rem 1.2rem;
        background-repeat: no-repeat;
        background-position: center;
    }
    
    .end-lesson-btn
    {
        background: var(--secondary-color);
        font-family: var(--header-font);
        color: #fff;
        font-weight: 500;
        font-size: 1.3rem;
        border: 3px solid #fff;
        border-radius: 3rem;
        padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(1.25rem, 3vmin, 2rem);
        text-shadow: 0 2px 0 #b88b2a;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: auto;
        min-width: 180px;
        margin-top: 2rem;
        cursor: pointer;
    }
    .end-lesson-btn:hover { transform: scale(1.06); box-shadow: 0 6px 24px rgba(0,0,0,0.18); }


    /* ===== RESPONSIVE DESIGN ===== */
    @media(min-width:1200px)
        {
            .strategy-card{
                min-height:121px
            }
        }  
          @media (max-width: 1199px) { html { font-size: 2.4vmin; } }
    @media (max-width: 1024px) { 
        #strategy-container { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        
    }
    @media (max-width: 991px) {
                #game-wrapper { width: 100vw !important; height: 100vh !important; border-radius: 0 !important; max-width: none !important; aspect-ratio: unset !important; box-shadow: none; } 
.strategy-card{
    font-size: 1.1rem;
}


      html { font-size: 3.2vmin; }
      #completion-image { max-width: 55%; }
      #takeaways-overlay .modal { max-width: 70vw; height: 63vh; margin-top: 4rem; }
       
    }
    @media (max-width: 768px) {
      html { font-size: 3.4vmin; }
      #start-screen h1 { font-size: 2.5rem; }
      .completion-title-banner { font-size: 2.8rem; }
      #completion-image { max-width: 65%; }
      .completion-buttons {padding: 1rem; align-items: center;}
      .completion-btn { min-width: 120px; }
       #activity-intro-overlay .modal{
            height: 95%;
            overflow: auto;
            max-width: 65vw;
        }
    
    }
    @media (max-width: 480px) { 
      html { font-size: 4.2vmin; } 
      #game-title { font-size: 1.2rem; }
      #strategy-container { grid-template-columns: 1fr; }
    }
</style>
</head>
<body>
<div id="game-wrapper">
   <div id="game-container">
       <div id="start-screen" class="screen">
           <h1>Build Your Personal Support Strategy</h1>
           <button class="start-button">Start Activity</button>
       </div>

       <div id="game-screen" class="screen hidden">
           <div class="game-top-section">
               <h1 id="game-title">Support Strategy Checklist</h1>
               <div class="top-right-controls">
                    <div id="progress-container">
                        <div id="progress-bar"></div>
                    </div>
                    <span id="progress-text">0 / 5</span>
                    <div class="control-icon" id="instructions-icon">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
                    </div>
                </div>
           </div>
           <div id="strategy-container">
                </div>
       </div>

        <div id="activity-intro-overlay" class="overlay hidden">
           <div class="modal">
                <h2>Activity Introduction</h2>
                <p>You have explored where support systems exist, and how they help. But how do you actually use them well? In this activity, you are going to build your own checklist of smart strategies. Click on the ones you think will help you make the most of your support systems.</p>
                <button id="close-intro-btn">Continue</button>
           </div>
       </div>

        <div id="instructions-overlay" class="overlay hidden">
            <div class="modal">
                <h2>Learner Instructions</h2>
                <p>Your task is to choose at least <strong>five</strong> strategies that you believe will help you succeed.</p>
                <ul>
                    <li>When you click a correct strategy, you'll see a tip, and it will be added to your checklist.</li>
                    <li>If you choose a distracting option, you'll get a gentle hint to think again.</li>
                </ul>
                <button id="close-instructions-btn">Got it!</button>
            </div>
        </div>

        <div id="feedback-modal-overlay" class="overlay hidden">
            <div class="modal feedback-modal">
                <div class="feedback-header">
                    <h2 id="feedback-title"></h2>
                </div>
                <p id="feedback-modal-text"></p>
                <button id="next-question-button" class="feedback-btn">Continue</button>
            </div>
        </div>

        <div id="completion-overlay" class="overlay hidden">
            <h2 class="completion-title-banner">Activity Conclusion!</h2>
            <div class="modal">
                <img id="completion-image" src="images/complete.jpg" alt="Completion celebration" onerror="this.src='https://placehold.co/400x300/7c3aed/ffffff?text=Complete!'; this.onerror=null;">
            </div>
            <div class="completion-buttons">
                <button class="completion-btn" id="previous-activity-btn">Previous Activity</button>
                <button class="completion-btn" id="restart-activity-btn">Restart Activity</button>
                <button class="completion-btn" id="show-takeaways-btn">Key Takeaways</button>
            </div>
        </div>

        <div id="takeaways-overlay" class="overlay hidden">
            <h2 class="takeaways-main-header">Lesson Complete</h2>
            <div class="modal">
                <div class="takeaways-header">
                    <h3>Key Takeaways</h3>
                </div>
                <ul id="takeaways-list"></ul>
            </div>
            <button class="end-lesson-btn" onclick="sendEvent(LessonEvent.END_LESSON, {lessonName: 'Designing Solutions to Challenges in Support Systems: Lesson 3'})">Brain Power Checkpoint</button>
        </div>
   </div>
</div>

<audio id="intro-audio" src="audio/intro.mp3" preload="auto"></audio>
<audio id="complete-audio" src="audio/outro.mp3" preload="auto"></audio>
<audio id="ding-sound" src="audio/ding.mp3" preload="auto"></audio>
<audio id="buzz-sound" src="audio/buzz.mp3" preload="auto"></audio>


<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const startBtn = document.querySelector('.start-button');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const strategyContainer = document.getElementById('strategy-container');

    // --- Modal & Overlay Elements ---
    const activityIntroOverlay = document.getElementById('activity-intro-overlay');
    const instructionsOverlay = document.getElementById('instructions-overlay');
    const feedbackModalOverlay = document.getElementById('feedback-modal-overlay');
    const completionOverlay = document.getElementById('completion-overlay');
    const takeawaysOverlay = document.getElementById('takeaways-overlay');
    const completionTitle = document.querySelector('#completion-overlay .completion-title-banner');

    // --- Button Elements ---
    const closeIntroBtn = document.getElementById('close-intro-btn');
    const instructionsIcon = document.getElementById('instructions-icon');
    const closeInstructionsBtn = document.getElementById('close-instructions-btn');
    const nextQuestionBtn = document.getElementById('next-question-button');
    const restartActivityBtn = document.getElementById('restart-activity-btn');
    const previousActivityBtn = document.getElementById('previous-activity-btn');
    const showTakeawaysBtn = document.getElementById('show-takeaways-btn');
    
    // --- Feedback Elements ---
    const feedbackHeader = feedbackModalOverlay.querySelector('.feedback-header');
    const feedbackTitle = document.getElementById('feedback-title');
    const feedbackText = document.getElementById('feedback-modal-text');

    // --- Takeaways Elements ---
    const takeawaysList = document.getElementById('takeaways-list');

    // --- Audio Elements ---
    const introAudio = document.getElementById('intro-audio');
    const completeAudio = document.getElementById('complete-audio');
    const dingSound = document.getElementById('ding-sound');
    const buzzSound = document.getElementById('buzz-sound');

    // --- SVG Icons ---
    const icons = {
        correct: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
        incorrect: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`
    };

    // --- Game Data ---
    const strategies = [
        { text: "Put recommendations into action", isCorrect: true, feedback: "Great choice! Support only works when you apply it. Acting on advice shows commitment." },
        { text: "Maintain regular and honest communication", isCorrect: true, feedback: "Nice! Staying in touch builds trust. Honesty helps supporters guide you better." },
        { text: "Join clubs or extra activities", isCorrect: true, feedback: "Smart! These places often provide informal mentorship and peer guidance." },
        { text: "Be clear about your goals", isCorrect: true, feedback: "Perfect! When you are clear about what you want, others can help you better." },
        { text: "Ask questions", isCorrect: true, feedback: "Excellent! Asking questions is a sign of strength, it helps you grow and stay curious." },
        { text: "Seek diverse sources of support", isCorrect: true, feedback: "Great thinking! One perspective is not always enough. Exploring different views helps you make better decisions." },
        { text: "Stay consistent with follow up", isCorrect: true, feedback: "Yes! Following up shows you are serious and builds long-term support relationships." },
        { text: "Reflect before reacting", isCorrect: true, feedback: "Wise choice! Thinking before reacting to advice helps you use it more effectively." },
        // Distractors
        { text: "Wait for someone to approach you", isCorrect: false, feedback: "Hmm... It is great when people offer help, but relying on that can leave you stuck." },
        { text: "Only talk to people your age", isCorrect: false, feedback: "Not quite. Friends are great, but adults or mentors often have more experience and can guide you better." },
        { text: "Ignore advice you disagree with immediately", isCorrect: false, feedback: "Careful, sometimes advice feels uncomfortable at first, but it is worth considering." },
        { text: "Keep problems to yourself to avoid bothering others", isCorrect: false, feedback: "That sounds respectful, but staying silent can make challenges worse." }
    ];

    const takeawaysData = [
        "Solutions to challenges include being proactive (taking initiative), seeking diverse resources, clarifying your goals, asking questions, and focusing on what works best for you.",
        "Effective use of support systems involves actively following advice, communicating honestly, participating in relevant activities, and being clear about your needs.",
        "Overcoming challenges often requires a combination of systemic changes and personal effort.",
        "Everyone can play a role in improving support systems.",
        "Solutions should be inclusive, accessible, and realistic."
    ];
    
    // --- Game State ---
    let selectedCount = 0;
    const requiredCount = 5;

    // --- Core Functions ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function initializeGame() {
        selectedCount = 0;
        updateProgressBar();
        populateTakeaways();
        populateStrategies();
    }

    function populateStrategies() {
        strategyContainer.innerHTML = '';
        const shuffledStrategies = shuffleArray([...strategies]);
        
        shuffledStrategies.forEach(strategy => {
            const card = document.createElement('div');
            card.className = 'strategy-card';
            card.innerHTML = `<span>${strategy.text}</span><div class="checkmark">✔</div><div class="crossmark">✖</div>`;
            card.dataset.correct = strategy.isCorrect;
            card.dataset.feedback = strategy.feedback;
            
            card.addEventListener('click', () => handleCardClick(card));
            strategyContainer.appendChild(card);
        });
    }

    function handleCardClick(card) {
        if (card.classList.contains('selected') || card.classList.contains('incorrect')) {
            return;
        }

        const isCorrect = card.dataset.correct === 'true';
        const feedback = card.dataset.feedback;

        if (isCorrect) {
            card.classList.add('selected');
            selectedCount++;
            updateProgressBar();
            showFeedback(true, feedback);
            if (selectedCount >= requiredCount) {
                checkGameCompletion();
            }
        } else {
            card.classList.add('incorrect');
            card.classList.add('shake');
            setTimeout(() => card.classList.remove('shake'), 500);
            showFeedback(false, feedback);
        }
    }
    
    function populateTakeaways() {
        takeawaysList.innerHTML = '';
        takeawaysData.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            takeawaysList.appendChild(li);
        });
    }

    function updateProgressBar() {
        const percentage = (selectedCount / requiredCount) * 100;
        progressBar.style.width = `${Math.min(percentage, 100)}%`;
        progressText.textContent = `${selectedCount} / ${requiredCount}`;
    }

    function showFeedback(isCorrect, message) {
        const titleText = isCorrect ? "Great Strategy!" : "Think Again...";
        feedbackTitle.innerHTML = `${isCorrect ? icons.correct : icons.incorrect} ${titleText}`;
        feedbackText.textContent = message;
        feedbackHeader.className = `feedback-header ${isCorrect ? 'correct' : 'incorrect'}`;
        nextQuestionBtn.className = `feedback-btn ${isCorrect ? 'correct' : 'incorrect'}`;
        feedbackModalOverlay.className = `overlay ${isCorrect ? 'correct-feedback' : 'incorrect-feedback'}`;
        playSound(isCorrect ? dingSound : buzzSound);
        feedbackModalOverlay.classList.remove('hidden');
    }
    
    function checkGameCompletion() {
        if (selectedCount >= requiredCount) {
            document.querySelectorAll('.strategy-card').forEach(c => c.style.pointerEvents = 'none');
            completionTitle.textContent = "Activity Conclusion!";
            setTimeout(() => {
                gameScreen.classList.add('hidden');
                completionOverlay.classList.remove('hidden');
                playSound(completeAudio);
            }, 1500);
        }
    }

    function playSound(sound) { if (sound) { sound.currentTime = 0; sound.play().catch(e => {}); } }
    
    function stopAllAudio() {
        [introAudio, completeAudio, dingSound, buzzSound].forEach(audio => { if (audio) { audio.pause(); audio.currentTime = 0; } });
    }

    // --- Event Listeners Setup ---
    startBtn.addEventListener('click', () => {
        startScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        activityIntroOverlay.classList.remove('hidden');
        playSound(introAudio);
        sendEvent(ActivityEvent.START_ACTIVITY, { activityName: 'Build Your Personal Support Strategy' });
    });

    closeIntroBtn.addEventListener('click', () => {
        stopAllAudio();
        activityIntroOverlay.classList.add('hidden');
        initializeGame();
    });

    instructionsIcon.addEventListener('click', () => instructionsOverlay.classList.remove('hidden'));
    closeInstructionsBtn.addEventListener('click', () => instructionsOverlay.classList.add('hidden'));

    nextQuestionBtn.addEventListener('click', () => {
        feedbackModalOverlay.classList.add('hidden');
    });

    restartActivityBtn.addEventListener('click', () => {
        stopAllAudio();
        completionOverlay.classList.add('hidden');
        takeawaysOverlay.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        initializeGame();
    });
    
    previousActivityBtn.addEventListener('click', () => {
        sendEvent(ActivityEvent.END_ACTIVITY, { activityName: 'Build Your Personal Support Strategy' });
        // You might want to change this URL if needed
        // window.location.href = '../PREVIOUS_ACTIVITY/index.html'; 
        window.location.href ="../ACTIVITY2/index.html";
    });

    showTakeawaysBtn.addEventListener('click', () => {
        stopAllAudio();
        completionOverlay.classList.add('hidden');
        takeawaysOverlay.classList.remove('hidden');
        sendEvent(ActivityEvent.END_ACTIVITY, { activityName: 'Build Your Personal Support Strategy' });
    });

});
</script>
<script src="../eventSender.js"></script>
</body>
</html>